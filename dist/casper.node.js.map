{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/eth/sc.js","webpack:///./src/index.js","webpack:///./src/promise.js","webpack:///./src/requestAdapters/node.js","webpack:///./src/requestAny.js","webpack:///./src/utils.js","webpack:///external \"bs58\"","webpack:///external \"form-data\"","webpack:///external \"fs\"","webpack:///external \"js-sha256\"","webpack:///external \"request\"","webpack:///external \"stream\"","webpack:///external \"stream-length\""],"names":["parseSCString","uuidToHash","require","SC_INTERFACE","SC_ADDR","sc","ensureSC","eth","Contract","getUploadNodes","fileSize","Promise","resolve","reject","methods","getPeers","call","then","data","ids","Object","keys","filter","key","startsWith","map","all","node","getIpPort","ipPorts","ipPort","replace","catch","err","console","error","getStoringNodes","uuid","fileHash","showStoringPeers","nodeHashes","hash","test","s","substring","length","module","exports","scEth","CasperPromise","requestAny","utils","REST_PORT","FormData","Casper","constructor","api","mode","blockchain","blockchainAPI","save","file","emit","isFile","TypeError","getFileSize","ips","method","url","on","event","ip","JSON","parse","UUID","delete","getFile","encoding","getLink","sharingNode","path","request","Duplex","fs","makeRequest","headers","triggerAbort","promise","requestConfig","formData","req","response","uploaded","total","form","maxDataSize","Infinity","append","getLength","chunk","downloaded","res","abort","bind","hostWorthTrying","host","rejected","canceled","config","Error","hosts","abortRequest","championHost","setChampion","handleProgress","progressHost","forEach","assign","possibleIps","done","bs58","sha256","stream","getStreamLength","val","codes","i","push","parseInt","substr","String","fromCharCode","apply","code","Buffer","Readable","byteLength","bytes","decode","sha","from","array","encoded","concat","encode"],"mappings":"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","file":"casper.node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading wasm modules\n \tvar installedWasmModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// object with all compiled WebAssembly.Modules\n \t__webpack_require__.w = {};\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","const { parseSCString, uuidToHash } = require('../utils')\r\n\r\n\r\nconst SC_INTERFACE = require('./sc.abi.json')\r\nconst SC_ADDR = 'Cb4d87043e63EB3F7B605f79906911C498A31B33'\r\nlet sc\r\nconst ensureSC = eth => { if( ! sc) sc = new eth.Contract(SC_INTERFACE, SC_ADDR) }\r\n\r\n\r\nconst getUploadNodes = (eth, { fileSize }) => new Promise((resolve, reject) => {\r\n  ensureSC(eth)\r\n\r\n  sc.methods.getPeers(fileSize).call()\r\n    .then(data => {\r\n      const ids = Object.keys(data)\r\n                    .filter(key => key.startsWith('id'))\r\n                    .map(key => data[key])\r\n\r\n      return Promise.all(\r\n        ids.map(node => sc.methods.getIpPort(node).call())\r\n      )\r\n    })\r\n    .then(ipPorts => ipPorts.map(ipPort => ipPort.replace(/:.*/, '')))\r\n    .then(resolve)\r\n    .catch(err => console.error(err))\r\n})\r\n\r\n\r\nconst getStoringNodes = (eth, { uuid }) => new Promise((resolve, reject) => {\r\n  ensureSC(eth)\r\n\r\n\r\n  const fileHash = uuidToHash(uuid)\r\n  sc.methods.showStoringPeers(fileHash).call()\r\n    .then(data => {\r\n      const nodeHashes = data.filter(hash => !/^0x0*$/.test(hash))\r\n                             .map(s => s.substring(0, s.length - 2))\r\n                             .map(parseSCString)\r\n\r\n      return Promise.all(\r\n        nodeHashes.map(node => sc.methods.getIpPort(node).call())\r\n      )\r\n    })\r\n    .then(ipPorts => ipPorts.map(ipPort => ipPort.replace(/:.*/, '')))\r\n    .then(resolve)\r\n    .catch(err => console.error(err))\r\n})\r\n\r\n\r\nmodule.exports = {\r\n  getUploadNodes,\r\n  getStoringNodes\r\n}","// we use commonsjs for node export\r\nconst scEth = require('./eth/sc')\r\nconst CasperPromise = require('./promise')\r\nconst requestAny = require('./requestAny')\r\nconst utils = require('./utils')\r\n\r\n\r\nconst REST_PORT = 5001\r\nconst sc = {\r\n  eth: scEth\r\n}\r\nif(CASPER_BUNDLE_TARGET === 'node') {\r\n  // var is here because we want hoisting\r\n  var FormData = require('form-data')\r\n}\r\n\r\n\r\nclass Casper {\r\n  constructor(api, mode) {\r\n    // Later we will add more blockchains and use autodetection, etherium is default mode \r\n    this.blockchain = mode || 'eth'\r\n    if(this.blockchain === 'eth') this.blockchainAPI = api.eth || api\r\n  }\r\n\r\n  /**\r\n   * Writes file into casper storage.\r\n   * If uuid is present file is overwritten\r\n   * @param {(Blob | Buffer | stream.Readable)} file \r\n   * @param {String} uuid file's unique id (from previous upload)\r\n   * @return {CasperPromise} resolves with uuid\r\n   */\r\n  save(file, uuid = false) {\r\n    return new CasperPromise((resolve, reject, emit) => {\r\n      if( ! utils.isFile(file)) {\r\n        throw new TypeError('Casper: file type must be File | Blob | ArrayBuffer | Buffer')\r\n      }\r\n\r\n      utils.getFileSize(file)\r\n        .then(fileSize => {\r\n          return sc[this.blockchain].getUploadNodes(this.blockchainAPI, { fileSize })\r\n        })\r\n        .then(ips => {\r\n          emit('sc-connected')         \r\n          let method, url\r\n          if(uuid) {\r\n            // Update\r\n            method = 'PUT'\r\n            url = `http://{host}:${REST_PORT}/casper/v0/file/${uuid}`\r\n          } else {\r\n            // Save new\r\n            method = 'POST'\r\n            url = `http://{host}:${REST_PORT}/casper/v0/file`\r\n          }\r\n\r\n          requestAny(method, url, ips, { file })\r\n            .on('progress', event => emit('progress', event))\r\n            .on('new-champion', ip => emit('node-found', ip))\r\n            .then(data => {\r\n              resolve(JSON.parse(data).UUID)\r\n            })\r\n            .catch(reject)\r\n        })\r\n        .catch(reject)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Deletes file from casper storage.  \r\n   * @param {String} uuid file's unique id (returned from upload)\r\n   * @return {CasperPromise} resolves with void\r\n   */\r\n  delete(uuid) {\r\n    return new CasperPromise((resolve, reject, emit) => {\r\n      sc[this.blockchain]\r\n        .getStoringNodes(this.blockchainAPI, { uuid })\r\n        .then(ips => {\r\n          emit('sc-connected')\r\n          requestAny('DELETE', `http://{host}:${REST_PORT}/casper/v0/file/${uuid}`, ips)\r\n            .on('new-champion', ip => emit('node-found', ip))\r\n            .then(resolve)\r\n            .catch(reject)\r\n        })\r\n        .catch(reject)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Gets file from casper storage.\r\n   * @param {String} uuid file's unique id (from upload)\r\n   * @return {CasperPromise} resolves with Blob | Buffer, after the whole file is downloaded\r\n   */\r\n  getFile(uuid) {\r\n    return new CasperPromise((resolve, reject, emit) => {\r\n      sc[this.blockchain]\r\n        .getStoringNodes(this.blockchainAPI, { uuid })\r\n        .then(ips => {\r\n          emit('sc-connected')\r\n          return ips\r\n        })\r\n        .then(ips => {\r\n          requestAny('GET', `http://{host}:${REST_PORT}/casper/v0/file/${uuid}`, ips, { encoding: null })\r\n            .on('progress', event => emit('progress', event))\r\n            .on('new-champion', ip => emit('node-found', ip))\r\n            .then(resolve)\r\n            .catch(reject)\r\n        })\r\n        .catch(reject)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Generates http link that allows to work with file the usual web way\r\n   * @param {String} uuid file's unique id (from upload)\r\n   */\r\n  getLink(uuid) {\r\n    return new CasperPromise((resolve, reject, emit) => {\r\n      let sharingNode = ''\r\n      sc[this.blockchain]\r\n        .getStoringNodes(this.blockchainAPI, { uuid })\r\n        .then(ips => {\r\n          emit('sc-connected')\r\n          requestAny('POST', `http://{host}:${REST_PORT}/casper/v0/share/${uuid}`, ips)\r\n            .on('new-champion', ip => sharingNode = ip)\r\n            .then(path => resolve(\r\n              `http://${sharingNode}:${REST_PORT}${path}`\r\n            ))\r\n            .catch(reject)\r\n        })\r\n        .catch(reject)\r\n    })\r\n  }\r\n}\r\n\r\n\r\nmodule.exports = Casper","class CasperPromise extends Promise {\r\n  constructor(cb) {\r\n    let realResolve\r\n    let realReject\r\n\r\n    const hijackControls = (resolve, reject) => {\r\n      realResolve = resolve\r\n      realReject = reject\r\n    }\r\n    \r\n    super(hijackControls)\r\n    this.subscribers = {}\r\n\r\n    this.on = this.on.bind(this)\r\n    this.emit = this.emit.bind(this)\r\n\r\n    cb(realResolve, realReject, this.emit)\r\n  }\r\n\r\n  on(event, cb) {\r\n    if(!this.subscribers[event]) this.subscribers[event] = []\r\n    this.subscribers[event].push(cb)\r\n    return this\r\n  }\r\n\r\n  emit(event, message) {\r\n    if(this.subscribers[event]) this.subscribers[event].forEach(cb => cb(message))\r\n  }\r\n}\r\n\r\n\r\nmodule.exports = CasperPromise","const request = require('request')\r\nconst Duplex = require('stream').Duplex\r\nconst CasperPromise = require('../promise')\r\nconst fs = require('fs')\r\n\r\n\r\nconst makeRequest = ({\r\n  method = 'GET',\r\n  url,\r\n  data = {},\r\n  file,\r\n  headers,\r\n  encoding\r\n}) => {\r\n  let triggerAbort\r\n\r\n  const promise = new CasperPromise((resolve, reject, emit) => {\r\n    // preparation\r\n    const requestConfig = {\r\n      method,\r\n      url,\r\n      headers,\r\n      encoding: null,\r\n      formData: data\r\n    }\r\n\r\n    // dispatching request\r\n    const req = request(requestConfig, (err, response, data) => {\r\n      if(err) {\r\n        return reject(err)\r\n      }\r\n      resolve(data)\r\n    })\r\n\r\n    if(file) {\r\n      // upload progress\r\n      let uploaded = 0\r\n      let total = 0\r\n  \r\n      const form = req.form()\r\n      form.maxDataSize = Infinity\r\n      form.append('file', file)\r\n      \r\n      form.getLength((err, length) => { total = length })\r\n      form.on('data', chunk => {\r\n        // this is form read progress but for fs.createReadStream it's realistic as http reads this in chunks\r\n        uploaded += chunk.length\r\n        if(total) emit('progress', uploaded / total)\r\n      })\r\n    } else {\r\n      // download progress\r\n      let total = 0\r\n      let downloaded = 0\r\n      req.on('response', res => {\r\n        total = res.headers['x-content-length']\r\n      })\r\n  \r\n      req.on('data', chunk => {\r\n        downloaded += chunk.length\r\n        if(total) emit('progress', downloaded / total)\r\n      })\r\n    }\r\n\r\n\r\n    // providing abort feature\r\n    triggerAbort = req.abort.bind(req)\r\n  })\r\n\r\n  promise.abort = triggerAbort\r\n  return promise\r\n}\r\n\r\n\r\nmodule.exports = makeRequest","let request\r\n\r\nif(CASPER_BUNDLE_TARGET === 'node') {\r\n  request = require('./requestAdapters/node')\r\n} else {\r\n  request = require('./requestAdapters/browser')\r\n}\r\n\r\nconst CasperPromise = require('./promise')\r\n\r\nconst hostWorthTrying = host => ( ! host.rejected) || host.canceled\r\n\r\n\r\nconst requestAny = (\r\n  method, url, \r\n  ips, \r\n  config = {}\r\n) => new CasperPromise((resolve, reject, emit) => {\r\n  if(ips.length === 0) reject(new Error('No hosts to handle request'))\r\n\r\n  ips = ips.filter(ip => ip !== '0.0.0.0')\r\n\r\n  // preparation\r\n  const hosts = ips.map(ip => ({\r\n    ip,\r\n    rejected: false,\r\n    canceled: false,\r\n    abortRequest: null\r\n  }))\r\n  \r\n  let championHost = ''\r\n  \r\n  const setChampion = host => {\r\n    championHost = host\r\n    emit('new-champion', host.ip)\r\n  }\r\n\r\n  const handleProgress = progressHost => event => {\r\n    if( ! championHost) setChampion(progressHost)\r\n    \r\n    hosts\r\n      .filter(host => host !== championHost)\r\n      .map(host => host.abortRequest())\r\n    \r\n    if(progressHost === championHost) {\r\n      emit('progress', event)\r\n    }\r\n  }\r\n\r\n\r\n  // dispatching requests\r\n  hosts.forEach(host => {\r\n    // would introcduce babel later\r\n    const req = request(Object.assign({}, config, {\r\n      method,\r\n      url: url.replace('{host}', host.ip),\r\n    }))\r\n    host.abortRequest = req.abort\r\n\r\n    req\r\n      .on('progress', handleProgress(host))\r\n      .then(response => {\r\n        // avoiding multiple resolves\r\n        if( ! championHost) setChampion(host)\r\n        if(host === championHost) resolve(response)\r\n      })\r\n      .catch(err => {\r\n        // console.log('Host err', err)\r\n        host.rejected = true\r\n\r\n        if(host === championHost) {\r\n          // trying other requests that didn't fail\r\n          const possibleIps = hosts\r\n                                .filter(hostWorthTrying)\r\n                                .map(host => host.ip)\r\n          \r\n\r\n          requestAny(method, url, possibleIps, config)\r\n            .on('progress', done => emit('progress', done))\r\n            .on('new-champion', ip => emit('new-champion', ip))\r\n            .then(resolve)\r\n            .catch(err => {\r\n              reject(new Error('All hosts are unreachable'))\r\n            })\r\n        } else if(hosts.filter(hostWorthTrying).length === 0) {\r\n          reject(new Error('All hosts are unreachable'))\r\n        }\r\n      })\r\n  })\r\n})\r\n\r\n\r\nmodule.exports = requestAny","const bs58 = require('bs58')\r\nconst sha256 = require('js-sha256')\r\n\r\nlet stream, getStreamLength\r\n\r\nif(CASPER_BUNDLE_TARGET === 'node') {\r\n  stream = require('stream')\r\n  getStreamLength = require('stream-length')\r\n}\r\n\r\nconst parseSCString = hash => {\r\n  const val = hash.substring(2)\r\n  const codes = []\r\n\r\n  for(let i=0; i < val.length; i += 2) {\r\n    codes.push(parseInt(val.substr(i, 2), 16))\r\n  }\r\n\r\n  return String.fromCharCode.apply(0, codes.filter(code => code !== 0))\r\n}\r\n\r\n\r\nconst isFile = file => {\r\n  if(CASPER_BUNDLE_TARGET === 'browser') {\r\n    if(file instanceof Blob) return true\r\n  }\r\n\r\n  if(CASPER_BUNDLE_TARGET === 'node') {\r\n    if(file instanceof Buffer) return true\r\n    if(file instanceof stream.Readable) return true\r\n  }\r\n  return false\r\n}\r\n\r\n\r\nconst getFileSize = file => new Promise(resolve => {\r\n  if(CASPER_BUNDLE_TARGET === 'browser') {\r\n    if (file instanceof Blob) resolve(file.size)\r\n  }\r\n  \r\n  if (CASPER_BUNDLE_TARGET === 'node') {\r\n    if(file instanceof stream.Readable) getStreamLength(file).then(resolve)\r\n    if(file instanceof Buffer) resolve(file.byteLength)\r\n  }\r\n})\r\n\r\n\r\nconst uuidToHash = uuid => {\r\n  const bytes = bs58.decode(uuid)\r\n  const sha = Buffer.from(sha256.array(bytes))\r\n  const encoded = Buffer.concat([\r\n    Buffer.from([18]), \r\n    Buffer.from([sha.length]), \r\n    sha\r\n  ])\r\n  const hash = bs58.encode(encoded)\r\n\r\n  return hash\r\n}\r\n\r\n\r\nmodule.exports = {\r\n  parseSCString,\r\n  isFile,\r\n  getFileSize,\r\n  uuidToHash\r\n}","module.exports = require(\"bs58\");","module.exports = require(\"form-data\");","module.exports = require(\"fs\");","module.exports = require(\"js-sha256\");","module.exports = require(\"request\");","module.exports = require(\"stream\");","module.exports = require(\"stream-length\");"],"sourceRoot":""}