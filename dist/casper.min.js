module.exports=function(t){var n={};function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=9)}([function(t,n,e){"use strict";t.exports=function(t){var n=void 0,e=void 0,i=new Promise(function(t,i){n=t,e=i});return i.subscribers={},i.emit=function(t,n){this.subscribers[t]&&this.subscribers[t].forEach(function(t){return t(n)})}.bind(i),i.on=function(t,n){return this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push(n),this}.bind(i),t(n,e,i.emit),i}},function(t,n,e){"use strict";var i=e(7),a=e(6),o=e(5),r=o.isFile,u=o.getFileSize;t.exports={parseSCString:function(t){for(var n=t.substring(2),e=[],i=0;i<n.length;i+=2)e.push(parseInt(n.substr(i,2),16));return String.fromCharCode.apply(0,e.filter(function(t){return 0!==t}))},isFile:r,getFileSize:u,uuidToHash:function(t){var n=a.decode(t),e=i.array(n),o=new Uint8Array([18,e.length].concat(e));return a.encode(o)}}},function(t,n,e){"use strict";var i=e(0);t.exports=function(t){var n=t.method,e=void 0===n?"GET":n,a=t.url,o=t.data,r=void 0===o?{}:o,u=t.file,s=(t.headers,t.encoding),p=void 0,c=i(function(t,n,i){var o=function(t){var n=t.loaded/t.total;n&&0<n&&n<=1&&i("progress",n)},c=new FormData;for(var y in r)c.append(y,r[y]);u&&c.append("file",u);var l=new XMLHttpRequest;null===s&&(l.responseType="blob"),u?l.upload.onprogress=o:l.onprogress=o,l.onload=function(n){return t(l.response)},l.onerror=function(t){return n(t)},l.open(e,a),l.send(c),p=l.abort.bind(l)});return c.abort=p,c}},function(t,n,e){"use strict";var i=e(2),a=e(0),o=function(t){return!t.rejected||t.canceled};t.exports=function t(n,e,r){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return a(function(a,s,p){0===(r=r.filter(function(t){return"0.0.0.0"!==t})).length&&s(new Error("casperapi: No hosts to handle request"));var c=r.map(function(t){return{ip:t,rejected:!1,canceled:!1,abortRequest:null}}),y="",l=function(t){y=t,p("new-champion",t.ip)};c.forEach(function(r){var f,m=i(Object.assign({},u,{method:n,url:e.replace("{host}",r.ip)}));r.abortRequest=m.abort,m.on("progress",(f=r,function(t){y||l(f),c.filter(function(t){return t!==y}).map(function(t){return t.abortRequest()}),f===y&&p("progress",t)})).then(function(t){y||l(r),r===y&&a(t)}).catch(function(i){if(r.rejected=!0,r===y){var l=c.filter(o).map(function(t){return t.ip});t(n,e,l,u).on("progress",function(t){return p("progress",t)}).on("new-champion",function(t){return p("new-champion",t)}).then(a).catch(function(t){s(new Error("casperapi: All hosts are unreachable"))})}else 0===c.filter(o).length&&s(new Error("casperapi: All hosts are unreachable"))})})})}},function(t){t.exports=[{constant:!1,inputs:[{name:"id",type:"string"},{name:"hash",type:"string"},{name:"size",type:"uint256"}],name:"confirmUpload",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"amount",type:"uint256"}],name:"addToken",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"srcID",type:"string"}],name:"getPingTarget",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"hash",type:"string"}],name:"showStoringPeers",outputs:[{name:"",type:"bytes32[4]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"ipfsAddr",type:"string"}],name:"getIpPort",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"confirmDownload",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getSystemState",outputs:[{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getAllPeers",outputs:[{name:"",type:"bytes32[]"},{name:"",type:"uint256[]"},{name:"",type:"bytes32[]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"nodeHash",type:"string"},{name:"telegram",type:"bytes32"},{name:"udpIpPort",type:"string"},{name:"ipPort",type:"string"},{name:"id",type:"string"},{name:"size",type:"uint256"}],name:"registerProvider",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsAddr",type:"string"},{name:"newIpPort",type:"string"}],name:"updateIpPort",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"id",type:"string"}],name:"removeProviderMachine",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"id",type:"string"},{name:"hash",type:"string"},{name:"size",type:"uint256"}],name:"confirmUpdate",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"ipfsAddr",type:"string"}],name:"getUDPIpPort",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"hash",type:"string"}],name:"getStoringPeers",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"id",type:"string"},{name:"n",type:"uint256"}],name:"getFile",outputs:[{name:"",type:"string"},{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"clearPrepay",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"client",type:"address"}],name:"isPrepaid",outputs:[{name:"prepaid",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"size",type:"uint256"}],name:"getPeers",outputs:[{name:"id1",type:"string"},{name:"id2",type:"string"},{name:"id3",type:"string"},{name:"id4",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"UUID",type:"string"},{name:"consensus",type:"bool[16]"},{name:"nodeIds",type:"bytes32[4]"}],name:"checkVerification",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"id",type:"string"}],name:"setBootstrap",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"pay",type:"uint256"}],name:"prePay",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"id",type:"string"}],name:"getNumberOfFiles",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"confirmTransfer",outputs:[],payable:!1,stateMutability:"pure",type:"function"},{constant:!0,inputs:[{name:"ipfsAddr",type:"string"}],name:"getNodeHash",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getBannedPeers",outputs:[{name:"",type:"bytes32[]"},{name:"",type:"uint256[]"},{name:"",type:"bytes32[]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"removeAllPeers",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"id",type:"string"}],name:"verifyReplication",outputs:[{name:"isBanned",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"nodeHash",type:"string"},{name:"telegram",type:"bytes32"},{name:"udpIpPort",type:"string"},{name:"ipPort",type:"string"},{name:"id",type:"string"},{name:"size",type:"uint256"}],name:"addProviderMachine",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"uuid",type:"uint128"}],name:"notifyDelete",outputs:[],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"uuid",type:"string"},{name:"id",type:"string"}],name:"notifyVerificationTarget",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getBootstrap",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"id",type:"string"},{name:"success",type:"bool"}],name:"sendPingResult",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsAddr",type:"string"},{name:"newUDPIpPort",type:"string"}],name:"updateUDPIpPort",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"id",type:"string"},{name:"hash",type:"string"},{name:"size",type:"uint256"}],name:"notifySpaceFreed",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"id",type:"string"}],name:"machineInformation",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"info",type:"string"}],name:"Log",type:"event"},{anonymous:!1,inputs:[],name:"ProviderCheckEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"banned",type:"string"}],name:"ProviderOffline",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"val",type:"string"}],name:"ReturnString",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"UUID",type:"string"},{indexed:!1,name:"id",type:"string"}],name:"verificationTarget",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"UUID",type:"string"},{indexed:!1,name:"consensus",type:"bytes32[4]"}],name:"ConsensusResult",type:"event"}]},function(t,n,e){"use strict";t.exports={isFile:function(t){return t instanceof Blob},getFileSize:function(t){return new Promise(function(n){if(t instanceof Blob)return n(t.size);reject(new Error("casperapi: Cannot compute file size"))})}}},function(t,n,e){"use strict";var i="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",a={encode:function(t){var n=[],e="",a=void 0,o=void 0,r=void 0,u=void 0;for(a in t)for(o=0,e+=(r=t[a])||e.length^a?"":1;o in n||r;)r=(u=(u=n[o])?256*u+r:r)/58|0,n[o]=u%58,o++;for(;o--;)e+=i[n[o]];return e},decode:function(t){var n=[],e=[],a=void 0,o=void 0,r=void 0,u=void 0;for(a in t){if(o=0,(r=i.indexOf(t[a]))<0)return;for(r||e.length^a||e.push(0);o in n||r;)r=(u=(u=n[o])?58*u+r:r)>>8,n[o]=u%256,o++}for(;o--;)e.push(n[o]);return new Uint8Array(e)}};t.exports=a},function(t,n){t.exports=require("js-sha256")},function(t,n,e){"use strict";var i=e(1),a=i.parseSCString,o=i.uuidToHash,r=e(4),u=void 0,s=function(t){u||(u=new t.Contract(r,"Cb4d87043e63EB3F7B605f79906911C498A31B33"))};t.exports={getUploadNodes:function(t,n){var e=n.fileSize;return new Promise(function(n,i){s(t),u.methods.getPeers(e).call().then(function(t){var n=Object.keys(t).filter(function(t){return t.startsWith("id")}).map(function(n){return t[n]});return Promise.all(n.map(function(t){return u.methods.getIpPort(t).call()}))}).then(function(t){return t.map(function(t){return t.replace(/:.*/,"")})}).then(n).catch(function(t){return console.error(t)})})},getStoringNodes:function(t,n){var e=n.uuid;return new Promise(function(n,i){s(t);var r=o(e);u.methods.showStoringPeers(r).call().then(function(t){var n=t.filter(function(t){return!/^0x0*$/.test(t)}).map(function(t){return t.substring(0,t.length-2)}).map(a);return Promise.all(n.map(function(t){return u.methods.getIpPort(t).call()}))}).then(function(t){return t.map(function(t){return t.replace(/:.*/,"")})}).then(n).catch(function(t){return console.error(t)})})}}},function(t,n,e){"use strict";var i=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();var a=e(8),o=e(0),r=e(3),u=e(1),s={eth:a},p=function(){function t(n,e){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.blockchain=e||"eth","eth"===this.blockchain&&(this.blockchainAPI=n.eth||n)}return i(t,[{key:"save",value:function(t){var n=this,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return o(function(i,a,o){if(!u.isFile(t))throw new TypeError("casperapi: file type must be File | Blob | ArrayBuffer | Buffer");u.getFileSize(t).then(function(t){return s[n.blockchain].getUploadNodes(n.blockchainAPI,{fileSize:t})}).then(function(n){o("sc-connected");var u=void 0,s=void 0;e?(u="PUT",s="http://{host}:5001/casper/v0/file/"+e):(u="POST",s="http://{host}:5001/casper/v0/file"),r(u,s,n,{file:t}).on("progress",function(t){return o("progress",t)}).on("new-champion",function(t){return o("node-found",t)}).then(function(t){i(JSON.parse(t).UUID)}).catch(a)}).catch(a)})}},{key:"delete",value:function(t){var n=this;return o(function(e,i,a){s[n.blockchain].getStoringNodes(n.blockchainAPI,{uuid:t}).then(function(n){a("sc-connected"),r("DELETE","http://{host}:5001/casper/v0/file/"+t,n).on("new-champion",function(t){return a("node-found",t)}).then(e).catch(i)}).catch(i)})}},{key:"getFile",value:function(t){var n=this;return o(function(e,i,a){s[n.blockchain].getStoringNodes(n.blockchainAPI,{uuid:t}).then(function(t){return a("sc-connected"),t}).then(function(n){r("GET","http://{host}:5001/casper/v0/file/"+t,n,{encoding:null}).on("progress",function(t){return a("progress",t)}).on("new-champion",function(t){return a("node-found",t)}).then(e).catch(i)}).catch(i)})}},{key:"getLink",value:function(t){var n=this;return o(function(e,i,a){var o="";s[n.blockchain].getStoringNodes(n.blockchainAPI,{uuid:t}).then(function(n){a("sc-connected"),r("POST","http://{host}:5001/casper/v0/share/"+t,n).on("new-champion",function(t){return o=t}).then(function(t){return e("http://"+o+":5001"+t)}).catch(i)}).catch(i)})}}]),t}();t.exports=p}]);