!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.casperapi=e():t.casperapi=e()}(window,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e,n){"use strict";t.exports=function(t){var e=void 0,n=void 0,i=new Promise(function(t,i){e=t,n=i});return i.subscribers={},i.emit=function(t,e){this.subscribers[t]&&this.subscribers[t].forEach(function(t){return t(e)})}.bind(i),i.on=function(t,e){return this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push(e),this}.bind(i),t(e,n,i.emit),i}},function(t,e,n){"use strict";var i=n(7),a=n(6),o=n(5),r=o.isFile,u=o.getFileSize;t.exports={parseSCString:function(t){for(var e=t.substring(2),n=[],i=0;i<e.length;i+=2)n.push(parseInt(e.substr(i,2),16));return String.fromCharCode.apply(0,n.filter(function(t){return 0!==t}))},isFile:r,getFileSize:u,uuidToHash:function(t){var e=a.decode(t),n=i.array(e),o=new Uint8Array([18,n.length].concat(n));return a.encode(o)}}},function(t,e,n){"use strict";var i=n(0);t.exports=function(t){var e=t.method,n=void 0===e?"GET":e,a=t.url,o=t.data,r=void 0===o?{}:o,u=t.file,s=t.headers,p=void 0===s?{}:s,c=t.encoding,y=void 0,l=i(function(t,e,i){var o=function(t){var e=t.loaded/t.total;e&&0<e&&e<=1&&i("progress",e)},s=new FormData;for(var l in r)s.append(l,r[l]);u&&s.append("file",u);var f=new XMLHttpRequest;for(var m in null===c&&(f.responseType="blob"),u?f.upload.onprogress=o:f.onprogress=o,f.onload=function(e){return t(f.response)},f.onerror=function(t){return e(t)},f.open(n,a),p)f.setRequestHeader(m,p[m]);f.send(s),y=f.abort.bind(f)});return l.abort=y,l}},function(t,e,n){"use strict";var i=n(2),a=n(0),o=function(t){return!t.rejected||t.canceled};t.exports=function t(e,n,r){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return a(function(a,s,p){0===(r=r.filter(function(t){return"0.0.0.0"!==t})).length&&s(new Error("casperapi: No hosts to handle request"));var c=r.map(function(t){return{ip:t,rejected:!1,canceled:!1,abortRequest:null}}),y="",l=function(t){y=t,p("new-champion",t.ip)};c.forEach(function(r){var f,m=i(Object.assign({},u,{method:e,url:n.replace("{host}",r.ip)}));r.abortRequest=m.abort,m.on("progress",(f=r,function(t){y||l(f),c.filter(function(t){return t!==y}).map(function(t){return t.abortRequest()}),f===y&&p("progress",t)})).then(function(t){y||l(r),r===y&&a(t)}).catch(function(i){if(r.rejected=!0,r===y){var l=c.filter(o).map(function(t){return t.ip});t(e,n,l,u).on("progress",function(t){return p("progress",t)}).on("new-champion",function(t){return p("new-champion",t)}).then(a).catch(function(t){s(new Error("casperapi: All hosts are unreachable"))})}else 0===c.filter(o).length&&s(new Error("casperapi: All hosts are unreachable"))})})})}},function(t){t.exports=[{constant:!1,inputs:[{name:"nodeID",type:"string"},{name:"fileID",type:"string"},{name:"size",type:"uint256"}],name:"confirmUpload",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"amount",type:"uint256"}],name:"addToken",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"fileID",type:"string"}],name:"showStoringPeers",outputs:[{name:"",type:"string"},{name:"",type:"string"},{name:"",type:"string"},{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"confirmDownload",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getSystemState",outputs:[{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getAllPeers",outputs:[{name:"",type:"bytes32[]"},{name:"",type:"uint256[]"},{name:"",type:"bytes32[]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"nodeID",type:"string"},{name:"addr",type:"string"}],name:"updateIpPort",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"nodeID",type:"string"},{name:"telegram",type:"bytes32"},{name:"apiIpPort",type:"string"},{name:"ipPort",type:"string"},{name:"size",type:"uint256"}],name:"registerProvider",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"nodeID",type:"string"}],name:"removeProviderMachine",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"nodeID",type:"string"},{name:"fileID",type:"string"},{name:"size",type:"uint256"}],name:"confirmUpdate",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"fileID",type:"string"}],name:"getStoringPeers",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"nodeID",type:"string"},{name:"n",type:"uint256"}],name:"getFile",outputs:[{name:"",type:"string"},{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"clearPrepay",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"client",type:"address"}],name:"isPrepaid",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"size",type:"uint256"},{name:"seed",type:"uint256"}],name:"getPeers",outputs:[{name:"",type:"string"},{name:"",type:"string"},{name:"",type:"string"},{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getBlockTime",outputs:[{name:"timestamp",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"nodeID",type:"string"},{name:"addr",type:"string"}],name:"updateAPIIpPort",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"fileID",type:"string"},{name:"consensus",type:"bool[16]"},{name:"nodeIds",type:"bytes32[4]"}],name:"checkVerification",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"id",type:"string"}],name:"setBootstrap",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"pay",type:"uint256"}],name:"prePay",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getPingTarget",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"nodeID",type:"string"}],name:"getNumberOfFiles",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"confirmTransfer",outputs:[],payable:!1,stateMutability:"pure",type:"function"},{constant:!0,inputs:[],name:"getBannedPeers",outputs:[{name:"",type:"bytes32[]"},{name:"",type:"uint256[]"},{name:"",type:"bytes32[]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"removeAllPeers",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"nodeID",type:"string"}],name:"verifyReplication",outputs:[{name:"isBanned",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"uint128"}],name:"notifyDelete",outputs:[],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"fileID",type:"string"},{name:"nodeID",type:"string"}],name:"notifyVerificationTarget",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getBootstrap",outputs:[{name:"id",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"nodeID",type:"string"},{name:"success",type:"bool"}],name:"sendPingResult",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"nodeID",type:"string"}],name:"getBanStats",outputs:[{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"nodeID",type:"string"}],name:"getNodeAddress",outputs:[{name:"",type:"string"},{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"nodeID",type:"string"},{name:"fileID",type:"string"},{name:"size",type:"uint256"}],name:"notifySpaceFreed",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"nodeID",type:"string"}],name:"machineInformation",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"info",type:"string"}],name:"Log",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"id",type:"string"}],name:"ProviderCheckEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"banned",type:"string"}],name:"ProviderOffline",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"val",type:"string"}],name:"ReturnString",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"UUID",type:"string"},{indexed:!1,name:"id",type:"string"}],name:"verificationTarget",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"UUID",type:"string"},{indexed:!1,name:"consensus",type:"bytes32[4]"}],name:"ConsensusResult",type:"event"}]},function(t,e,n){"use strict";t.exports={isFile:function(t){return t instanceof Blob},getFileSize:function(t){return new Promise(function(e){if(t instanceof Blob)return e(t.size);reject(new Error("casperapi: Cannot compute file size"))})}}},function(t,e,n){"use strict";var i="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",a={encode:function(t){var e=[],n="",a=void 0,o=void 0,r=void 0,u=void 0;for(a in t)for(o=0,n+=(r=t[a])||n.length^a?"":1;o in e||r;)r=(u=(u=e[o])?256*u+r:r)/58|0,e[o]=u%58,o++;for(;o--;)n+=i[e[o]];return n},decode:function(t){var e=[],n=[],a=void 0,o=void 0,r=void 0,u=void 0;for(a in t)for(o=0,(r=i.indexOf(t[a]))||n.length^a||n.push(0);o in e||r;)r=(u=(u=e[o])?58*u+r:r)>>8,e[o]=u%256,o++;for(;o--;)n.push(e[o]);return new Uint8Array(n)}};t.exports=a},function(t,e){t.exports=require("js-sha256")},function(t,e,n){"use strict";var i=n(1),a=(i.parseSCString,i.uuidToHash),o=n(4),r={development:"63477527FBb78D1044426b879eB875883c5600FF",production:"ff89Eb252F1E9C6638823C819DC0b2Ce3bFae7F5"},u={development:[],production:[]},s=function(t,e){var n=!0,i=!1,a=void 0;try{for(var s,p=u[e][Symbol.iterator]();!(n=(s=p.next()).done);n=!0){var c=s.value;if(c.eth===t)return c.sc}}catch(t){i=!0,a=t}finally{try{!n&&p.return&&p.return()}finally{if(i)throw a}}var y={eth:t,sc:new t.Contract(o,r[e])};return u[e].push(y),y.sc};t.exports={getUploadNodes:function(t,e){var n=e.fileSize,i=e.mode;return new Promise(function(e,a){var o=s(t,i),r=Math.round(1e5*Math.random());o.methods.getPeers(n,r).call().then(function(t){var e=Object.values(t);return Promise.all(e.map(function(t){return new Promise(function(e,n){return o.methods.getNodeAddress(t).call().then(function(n){return e({ip:n[0].replace(/:.*/,""),ipfs:n[1],hash:t})}).catch(n)})}))}).then(e)})},getStoringNodes:function(t,e){var n=e.uuid,i=e.mode;return new Promise(function(e,o){var r=s(t,i),u=a(n);r.methods.showStoringPeers(u).call().then(function(t){var e=[];for(var n in t){var i=t[n];i.length&&e.push(i)}return Promise.all(e.map(function(t){return r.methods.getNodeAddress(t).call()}))}).then(function(t){return t.map(function(t){return t[0].replace(/:.*/,"")})}).then(e)})}}},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var a=n(8),o=n(0),r=n(3),u=n(1),s={eth:a},p=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.blockchain,a=void 0===i?"eth":i,o=n.mode,r=void 0===o?"development":o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.blockchain=a,this.mode=r,"eth"===this.blockchain&&(this.blockchainAPI=e.eth||e)}return i(t,[{key:"save",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return o(function(i,a,o){if(!u.isFile(t))throw new TypeError("casperapi: file type must be File | Blob | Buffer | stream.Readable");u.getFileSize(t).then(function(t){return s[e.blockchain].getUploadNodes(e.blockchainAPI,{fileSize:t,mode:e.mode})}).then(function(e){o("sc-connected");var u=e.map(function(t){return t.ip}),s=e.map(function(t){return t.ipfs+"/ipfs/"+t.hash}),p={"X-Peers":JSON.stringify(s)},c=void 0,y=void 0;n?(c="PUT",y="http://{host}:5001/casper/v0/file/"+n):(c="POST",y="http://{host}:5001/casper/v0/file"),r(c,y,u,{file:t,headers:p}).on("progress",function(t){return o("progress",t)}).on("new-champion",function(t){return o("node-found",t)}).then(function(t){i(JSON.parse(t).UUID)}).catch(a)}).catch(a)})}},{key:"delete",value:function(t){var e=this;return o(function(n,i,a){s[e.blockchain].getStoringNodes(e.blockchainAPI,{uuid:t,mode:e.mode}).then(function(e){a("sc-connected"),r("DELETE","http://{host}:5001/casper/v0/file/"+t,e).on("new-champion",function(t){return a("node-found",t)}).then(n).catch(i)}).catch(i)})}},{key:"getFile",value:function(t){var e=this;return o(function(n,i,a){s[e.blockchain].getStoringNodes(e.blockchainAPI,{uuid:t,mode:e.mode}).then(function(t){return a("sc-connected"),t}).then(function(e){r("GET","http://{host}:5001/casper/v0/file/"+t,e,{encoding:null}).on("progress",function(t){return a("progress",t)}).on("new-champion",function(t){return a("node-found",t)}).then(n).catch(i)}).catch(i)})}},{key:"getLink",value:function(t){var e=this;return o(function(n,i,a){var o="";s[e.blockchain].getStoringNodes(e.blockchainAPI,{uuid:t,mode:e.mode}).then(function(e){a("sc-connected"),r("POST","http://{host}:5001/casper/v0/share/"+t,e).on("new-champion",function(t){return o=t}).then(function(t){return n("http://"+o+":5001"+t)}).catch(i)}).catch(i)})}}]),t}();t.exports=p}])});