!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.casperapi=n():e.casperapi=n()}(window,function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=10)}([function(e,n,t){"use strict";e.exports=function(e){var n=void 0,t=void 0,r=new Promise(function(e,r){n=e,t=r});return r.subscribers={},r.emit=function(e,n){this.subscribers[e]&&this.subscribers[e].forEach(function(e){return e(n)})}.bind(r),r.on=function(e,n){return this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push(n),this}.bind(r),e(n,t,r.emit),r}},function(e,n,t){"use strict";var r=t(8),o=t(7),i=t(6),u=t(5),c=u.isFile,s=u.getFileSize;e.exports={parseSCString:function(e){for(var n=e.substring(2),t=[],r=0;r<n.length;r+=2)t.push(parseInt(n.substr(r,2),16));return String.fromCharCode.apply(0,t.filter(function(e){return 0!==e}))},isFile:c,getFileSize:s,uuidToHash:function(e){var n=o.decode(e);return"0x"+r(n)},nodeIdToBytes:function(e){var n=e.substr(2),t=i.toBytes("1220"+n);return o.encode(t)}}},function(e,n,t){"use strict";var r=t(0);e.exports=function(e){var n=e.method,t=void 0===n?"GET":n,o=e.url,i=e.data,u=void 0===i?{}:i,c=e.file,s=e.headers,a=void 0===s?{}:s,f=e.encoding,p=void 0,l=r(function(e,n,r){var i=function(e){var n=e.loaded/e.total;n&&0<n&&n<=1&&r("progress",n)},s=new FormData;for(var l in u)s.append(l,u[l]);c&&s.append("file",c);var d=new XMLHttpRequest;for(var h in null===f&&(d.responseType="blob"),c?d.upload.onprogress=i:d.onprogress=i,d.onload=function(n){return e(d.response)},d.onerror=function(e){return n(e)},d.open(t,o),a)d.setRequestHeader(h,a[h]);d.send(s),p=d.abort.bind(d)});return l.abort=p,l}},function(e,n,t){"use strict";var r=t(2),o=t(0),i=function(e){return!e.rejected||e.canceled};e.exports=function e(n,t,u){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o(function(o,s,a){0===(u=u.filter(function(e){return"0.0.0.0"!==e})).length&&s(new Error("casperapi: No hosts to handle request"));var f=u.map(function(e){return{ip:e,rejected:!1,canceled:!1,abortRequest:null}}),p="",l=function(e){p=e,a("new-champion",e.ip)};f.forEach(function(u){var d,h=r(Object.assign({},c,{method:n,url:t.replace("{host}",u.ip)}));u.abortRequest=h.abort,h.on("progress",(d=u,function(e){p||l(d),f.filter(function(e){return e!==p}).map(function(e){return e.abortRequest()}),d===p&&a("progress",e)})).then(function(e){p||l(u),u===p&&o(e)}).catch(function(r){if(u.rejected=!0,u===p){var l=f.filter(i).map(function(e){return e.ip});e(n,t,l,c).on("progress",function(e){return a("progress",e)}).on("new-champion",function(e){return a("new-champion",e)}).then(o).catch(function(e){s(new Error("casperapi: All hosts are unreachable"))})}else 0===f.filter(i).length&&s(new Error("casperapi: All hosts are unreachable"))})})})}},function(e){e.exports=[{constant:!0,inputs:[{name:"nodeID",type:"bytes32"}],name:"getNodeAddr",outputs:[{name:"",type:"string"},{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"fileID",type:"bytes32"}],name:"getStoringPeers",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"fileID",type:"bytes32"}],name:"showStoringPeers",outputs:[{name:"",type:"bytes32[]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"size",type:"uint256"},{name:"seed",type:"uint256"}],name:"getPeers",outputs:[{name:"",type:"bytes32[]"}],payable:!1,stateMutability:"view",type:"function"}]},function(e,n,t){"use strict";e.exports={isFile:function(e){return e instanceof Blob},getFileSize:function(e){return new Promise(function(n){if(e instanceof Blob)return n(e.size);reject(new Error("casperapi: Cannot compute file size"))})}}},function(e,n,t){"use strict";e.exports={toBytes:function(e){for(var n=[];e.length>=2;)n.push(parseInt(e.substring(0,2),16)),e=e.substring(2,e.length);return n}}},function(e,n,t){"use strict";var r="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",o={decode:function(e){var n=[],t=[],o=void 0,i=void 0,u=void 0,c=void 0;for(o in e)for(i=0,(u=r.indexOf(e[o]))||t.length^o||t.push(0);i in n||u;)u=(c=(c=n[i])?58*c+u:u)>>8,n[i]=c%256,i++;for(;i--;)t.push(n[i]);return new Uint8Array(t)},encode:function(e){var n=[],t="",o=void 0,i=void 0,u=void 0,c=void 0;for(o in e)for(i=0,t+=(u=e[o])||t.length^o?"":1;i in n||u;)u=(c=(c=n[i])?256*c+u:u)/58|0,n[i]=c%58,i++;for(;i--;)t+=r[n[i]];return t}};e.exports=o},function(e,n){e.exports=require("js-sha256")},function(e,n,t){"use strict";var r=t(1),o=(r.parseSCString,r.uuidToHash),i=r.nodeIdToBytes,u=t(4),c={development:"b4854255e34a089FBae02709A35ddc854D238d0C",production:"ff89Eb252F1E9C6638823C819DC0b2Ce3bFae7F5"},s={development:[],production:[]},a=function(e,n){var t=!0,r=!1,o=void 0;try{for(var i,a=s[n][Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var f=i.value;if(f.eth===e)return f.sc}}catch(e){r=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw o}}var p={eth:e,sc:new e.Contract(u,c[n])};return s[n].push(p),p.sc};e.exports={getUploadNodes:function(e,n){var t=n.fileSize,r=n.mode;return new Promise(function(n,o){var u=a(e,r),c=Math.round(1e5*Math.random());u.methods.getPeers(t,c).call().then(function(e){var n=Object.values(e);return Promise.all(n.map(function(e){return new Promise(function(n,t){return u.methods.getNodeAddr(e).call().then(function(t){return n({ip:t[0].replace(/:.*/,""),ipfs:t[1],hash:i(e)})}).catch(t)})}))}).then(function(e){return e.filter(function(e){return e.ip})}).then(n)})},getStoringNodes:function(e,n){var t=n.uuid,r=n.mode;return new Promise(function(n,i){var u=a(e,r),c=o(t);u.methods.showStoringPeers(c).call().then(function(e){var n=Object.values(e);return Promise.all(n.map(function(e){return u.methods.getNodeAddr(e).call()}))}).then(function(e){return e.filter(function(e){return e[0]})}).then(function(e){return e.map(function(e){return e[0].replace(/:.*/,"")})}).then(n)})}}},function(e,n,t){"use strict";var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();var o=t(9),i=t(0),u=t(3),c=t(1),s={eth:o},a=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.blockchain,o=void 0===r?"eth":r,i=t.mode,u=void 0===i?"development":i;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.blockchain=o,this.mode=u,"eth"===this.blockchain&&(this.blockchainAPI=n.eth||n)}return r(e,[{key:"save",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i(function(r,o,i){if(!c.isFile(e))throw new TypeError("casperapi: file type must be File | Blob | Buffer | stream.Readable");c.getFileSize(e).then(function(e){return s[n.blockchain].getUploadNodes(n.blockchainAPI,{fileSize:e,mode:n.mode})}).then(function(n){i("sc-connected");var c=n.map(function(e){return e.ip}),s=n.map(function(e){return e.ipfs+"/ipfs/"+e.hash}),a={"X-Peers":JSON.stringify(s)},f=void 0,p=void 0;t?(f="PUT",p="http://{host}:5001/casper/v0/file/"+t):(f="POST",p="http://{host}:5001/casper/v0/file"),u(f,p,c,{file:e,headers:a}).on("progress",function(e){return i("progress",e)}).on("new-champion",function(e){return i("node-found",e)}).then(function(e){r(JSON.parse(e).UUID)}).catch(o)}).catch(o)})}},{key:"delete",value:function(e){var n=this;return i(function(t,r,o){s[n.blockchain].getStoringNodes(n.blockchainAPI,{uuid:e,mode:n.mode}).then(function(n){o("sc-connected"),u("DELETE","http://{host}:5001/casper/v0/file/"+e,n).on("new-champion",function(e){return o("node-found",e)}).then(t).catch(r)}).catch(r)})}},{key:"getFile",value:function(e){var n=this;return i(function(t,r,o){s[n.blockchain].getStoringNodes(n.blockchainAPI,{uuid:e,mode:n.mode}).then(function(e){return o("sc-connected"),e}).then(function(n){u("GET","http://{host}:5001/casper/v0/file/"+e,n,{encoding:null}).on("progress",function(e){return o("progress",e)}).on("new-champion",function(e){return o("node-found",e)}).then(t).catch(r)}).catch(r)})}},{key:"getLink",value:function(e){var n=this;return i(function(t,r,o){var i="";s[n.blockchain].getStoringNodes(n.blockchainAPI,{uuid:e,mode:n.mode}).then(function(n){o("sc-connected"),u("POST","http://{host}:5001/casper/v0/share/"+e,n).on("new-champion",function(e){return i=e}).then(function(e){return t("http://"+i+":5001"+e)}).catch(r)}).catch(r)})}}]),e}();e.exports=a}])});